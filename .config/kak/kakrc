source "%val{config}/plugins/plug.kak/rc/plug.kak"
plug "andreyorst/plug.kak" noload
plug "alexherbo2/auto-pairs.kak"
plug "danr/kakoune-easymotion"
plug "occivink/kakoune-gdb"
plug "occivink/kakoune-sudo-write"
plug "insipx/kak-crosshairs"
#plug "Bodhizafa/kak-rainbow" # Kind of confusing...
plug "andreyorst/fzf.kak" config %{
    map -docstring 'fzf mode' global normal '<c-p>' ': fzf-mode<ret>'
} defer 'fzf-file' %{
    set-option global fzf_file_command 'fd -HI'
} defer 'fzf-grep' %{
    set-option global fzf_grep_command 'rg'
}
plug "eraserhd/parinfer-rust" do %{
    cargo install --force --path .
    cargo clean
} config %{
    hook global WinSetOption filetype=(clojure|lisp|scheme|racket) %{
        parinfer-enable-window -smart
    }
}
plug "andreyorst/powerline.kak" config %{
    powerline-start
}
#eval %sh{kak-lsp --kakoune -s $kak_session}
#set global lsp_cmd "kak-lsp -s %val{session} -vvv --log /tmp/kak-lsp.log" # kak-lsp debug
hook global WinSetOption filetype=(rust|python|go|javascript|typescript|tsx|deno|vue|c|cpp|elixir) %{
    lsp-enable-window
    lsp-auto-hover-enable
    #rainbow-enable-window
    enable-auto-pairs
    #add-highlighter global/ number-lines
    set-option window ui_options ncurses_assistant=off
    map window user e -docstring 'next error (lsp)' : lsp-find-error<ret>
    map window user , -docstring 'code-actions' : lsp-code-actions<ret>
    map window user r -docstring 'refactor' : lsp-rename-prompt<ret>
    map window user L -docstring 'lint' : lint<ret>
    map window user F -docstring 'format' : format<ret>
    set-option window indentwidth 2
    set-option window tabstop 2
}

hook global WinSetOption filetype=(c|cpp) %{
    declare-user-mode gdb
    set-option buffer formatcmd 'clang-format --style=Google'
    map window gdb b -docstring 'gdb-set-breakpoint' ': gdb-set-breakpoint<ret>'
    map window gdb B -docstring 'gdb-clear-breakpoint' ': gdb-clear-breakpoint<ret>'
    map window gdb c -docstring 'gdb-continue-or-run' ': gdb-continue-or-run<ret>'
    map window gdb n -docstring 'gdb-session-new' ':gdb-session-new --command ./c.gdb<ret>'
    map window gdb N -docstring 'gdb-session-stop' ': gdb-session-stop<ret>'
    map window gdb p -docstring 'gdb-print' ': gdb-print<ret>'
    map window user g -docstring 'gdb' ': enter-user-mode gdb<ret>'
    hook buffer -group format BufWritePre .* format
    hook buffer -group build BufWritePost .*.(cpp|h) nop %sh{ ./build.sh }
}

hook global WinSetOption filetype=terraform %{
    set-option buffer formatcmd 'terraform fmt -'
    hook buffer -group format BufWritePre .* format
}

hook global NormalKey y %{ nop %sh{
      printf %s "$kak_main_reg_dquote" | xsel --input --clipboard
}}

map global user p -docstring 'paste from clipboard' '<a-!>xsel --output --clipboard<ret>'
map global user w -docstring 'easy-motion (word)' ': easy-motion-w<ret>'
map global user W -docstring 'easy-motion (WORD)' ': easy-motion-W<ret>'
map global user l -docstring 'easy-motion (line)' ': easy-motion-line<ret>'
map global user < -docstring 'previous buffer' ': buffer-previous<ret>'
map global user > -docstring 'next buffer' ': buffer-next<ret>'
map global user d -docstring 'delete buffer' ': delete-buffer<ret>'
map global user D -docstring 'force delete buffer' ': delete-buffer!<ret>'
map global user . -docstring 'save-all-buffers' ': write-all<ret>'
map global user / -docstring 'comment-line' ': comment-line<ret>'
